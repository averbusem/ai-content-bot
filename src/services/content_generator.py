from datetime import datetime, timedelta
from typing import Optional, Dict, Any
from .models.gigachat import GigaChatModel


class ContentGenerator:
    def __init__(self, gigachat_model: GigaChatModel):
        self.model = gigachat_model
        self.ngo_info: Optional[Dict[str, Any]] = None

    def set_ngo_info(self, ngo_info: Dict[str, Any]):
        self.ngo_info = ngo_info

    def _build_ngo_context(self) -> str:
        """–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–± –ù–ö–û –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞"""
        if not self.ngo_info:
            return ""

        context_parts = []

        if self.ngo_info.get("name"):
            context_parts.append(f"–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: {self.ngo_info['name']}")

        if self.ngo_info.get("activity"):
            context_parts.append(f"–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {self.ngo_info['activity']}")

        forms = self.ngo_info.get("forms", [])
        if forms:
            forms_list = []
            for form_key in forms:
                if form_key == "other":
                    other_text = self.ngo_info.get("forms_other", "")
                    if other_text:
                        forms_list.append(other_text)
                else:
                    forms_list.append(form_key)
            if forms_list:
                context_parts.append(f"–§–æ—Ä–º—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: {', '.join(forms_list)}")

        if self.ngo_info.get("region"):
            context_parts.append(f"–†–µ–≥–∏–æ–Ω —Ä–∞–±–æ—Ç—ã: {self.ngo_info['region']}")

        if context_parts:
            return "\n".join(context_parts)
        return ""

    async def generate_free_text_post(
            self,
            user_idea: str,
            style: str = "—Ç—ë–ø–ª—ã–π –∏ —á–µ–ª–æ–≤–µ—á–Ω—ã–π",
            additional_info: Optional[str] = None
    ) -> str:
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

        {ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}

        üéØ –ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û:
        –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ñ–∞–∫—Ç—ã –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π:
        - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Å—É–º–º—ã (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã)
        - –ò–º–µ–Ω–∞ –ª—é–¥–µ–π (–µ—Å–ª–∏ –Ω–µ –Ω–∞–∑–≤–∞–Ω—ã)
        - –¢–æ—á–Ω—ã–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º—è (–µ—Å–ª–∏ –Ω–µ –¥–∞–Ω—ã)
        - –î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏–π (–µ—Å–ª–∏ –Ω–µ –æ–ø–∏—Å–∞–Ω—ã)
        - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è (–µ—Å–ª–∏ –Ω–µ —É–ø–æ–º—è–Ω—É—Ç—ã)

        ‚úÖ –ß–¢–û –ú–û–ñ–ù–û:
        - –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–∫—Ä–∞—Å–∫—É –∫ –ò–ú–ï–Æ–©–ò–ú–°–Ø —Ñ–∞–∫—Ç–∞–º
        - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
        - –î–æ–±–∞–≤–ª—è—Ç—å —É–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é
        - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ë–ï–ó –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π

        üìù –ü–†–ò–ó–ù–ê–ö–ò –•–û–†–û–®–ï–ì–û –ü–û–°–¢–ê:
        1. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å: –µ—Å–ª–∏ –µ—Å—Ç—å –¥–µ—Ç–∞–ª–∏ - –∏—Å–ø–æ–ª—å–∑—É–π –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é
        2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ–º–æ–≥–∏ —á–∏—Ç–∞—Ç–µ–ª—é –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é
        3. –ò—Å—Ç–æ—Ä–∏—è, –Ω–µ –æ—Ç—á—ë—Ç: –ø–æ–∫–∞–∂–∏ –ø—Ä–æ—Ü–µ—Å—Å, –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        4. –ß–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å: —Ñ–æ–∫—É—Å –Ω–∞ –ª—é–¥—è—Ö –∏ –∏—Ö –∏—Å—Ç–æ—Ä–∏—è—Ö (–µ—Å–ª–∏ —É–ø–æ–º—è–Ω—É—Ç—ã)
        5. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: —á—Ç–æ ‚Üí –∫–∞–∫ ‚Üí –∑–∞—á–µ–º ‚Üí —á—Ç–æ –¥–∞–ª—å—à–µ
        6. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–∑—ã–≤: –Ω–µ –Ω–∞–≤—è–∑—á–∏–≤–æ, –∫–∞–∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –º—ã—Å–ª–∏

        üìê –°–¢–†–£–ö–¢–£–†–ê:
        ‚Ä¢ –°–∏–ª—å–Ω–æ–µ –Ω–∞—á–∞–ª–æ (–≤–æ–ø—Ä–æ—Å/—Ñ–∞–∫—Ç/–∏–Ω—Ç—Ä–∏–≥–∞) - 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
        ‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å (—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Ç–µ–º—ã) - 2-3 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞–±–∑–∞—Ü–∞ –ø–æ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        ‚Ä¢ –î–µ—Ç–∞–ª–∏/–ø—Ä–æ—Ü–µ—Å—Å (–µ—Å–ª–∏ –µ—Å—Ç—å) - —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –∞–±–∑–∞—Ü
        ‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–≤—ã–≤–æ–¥/–ø—Ä–∏–∑—ã–≤/–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å) - 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        ‚Ä¢ –•–µ—à—Ç–µ–≥–∏: 2-4 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö

        üé® –°–¢–ò–õ–¨: {style}

        ‚öôÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
        - –î–ª–∏–Ω–∞: 150-350 —Å–ª–æ–≤
        - –≠–º–æ–¥–∑–∏: 1-3 —à—Ç—É–∫–∏ (–≤ –Ω–∞—á–∞–ª–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –∏–ª–∏ –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤)
        - –ê–±–∑–∞—Ü—ã: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è max
        - –°–ø–∏—Å–∫–∏: –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ (‚úÖ ‚úì ‚Ä¢ ‚Üí)
        - –•–µ—à—Ç–µ–≥–∏: –≤ –∫–æ–Ω—Ü–µ, —Å # –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
        - –ë–µ–∑ –≤–æ–¥—ã, –∫–∞–Ω—Ü–µ–ª—è—Ä–∏–∑–º–æ–≤, —à—Ç–∞–º–ø–æ–≤
        - –ñ–∏–≤–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —è–∑—ã–∫, –Ω–æ –≥—Ä–∞–º–æ—Ç–Ω—ã–π

        ‚ùå –ò–ó–ë–ï–ì–ê–ô:
        - "–°–ø–µ—à–∏–º —Å–æ–æ–±—â–∏—Ç—å" (–∫–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç)
        - –ò–∑–±—ã—Ç–æ—á–Ω—ã—Ö –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤!!!
        - –ü–∞—Ñ–æ—Å–∞ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
        - –û–±—â–∏—Ö —Ñ—Ä–∞–∑ —Ç–∏–ø–∞ "–º—ã –º–µ–Ω—è–µ–º –º–∏—Ä"
        """

        prompt = f"""–°–æ–∑–¥–∞–π –ø–æ—Å—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞.

        –ò–°–•–û–î–ù–ê–Ø –ò–î–ï–Ø:
        {user_idea}

        {f"–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: {additional_info}" if additional_info else ""}

        –í–ê–ñ–ù–û: 
        –†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ —Å —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ï—Å–ª–∏ –¥–µ—Ç–∞–ª–µ–π –º–∞–ª–æ - —Å–¥–µ–ª–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π —ë–º–∫–∏–π –ø–æ—Å—Ç.
        –ï—Å–ª–∏ –¥–µ—Ç–∞–ª–µ–π –º–Ω–æ–≥–æ - —Ä–∞—Å–∫—Ä–æ–π –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ.

        –ù–ï –î–û–î–£–ú–´–í–ê–ô –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –≤–∑—è—Ç—å –≠–¢–ò —Ñ–∞–∫—Ç—ã –∏ –ø–æ–¥–∞—Ç—å –∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ."""
        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.7
        )

    async def generate_structured_post(
            self,
            event_type: str,
            date: str,
            location: str,
            participants: str,
            details: str,
            style: str = "—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π"
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ —à–∞–±–ª–æ–Ω—É

        Args:
            event_type: –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
            date: –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è
            location: –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
            participants: –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω
            details: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
            style: –°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞

        Returns:
            –ì–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç
        """
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
–°–æ–∑–¥–∞–≤–∞–π –ø–æ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

{ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –°—Ç–∏–ª—å: {style}
        - –õ–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        - –ü—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞
        - 2-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–∞"""

        prompt = f"""–°–æ–∑–¥–∞–π –∞–Ω–æ–Ω—Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

        –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: {event_type}
        –î–∞—Ç–∞: {date}
        –ú–µ—Å—Ç–æ: {location}
        –£—á–∞—Å—Ç–Ω–∏–∫–∏: {participants}
        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏: {details}

        –°–æ–∑–¥–∞–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç-–∞–Ω–æ–Ω—Å."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.7
        )

    async def generate_content_plan(
            self,
            duration_days: int,
            posts_per_week: int,
            preferences: Optional[str] = None
    ) -> str:

        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - SMM-—Å—Ç—Ä–∞—Ç–µ–≥ –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
    –°–æ–∑–¥–∞–≤–∞–π –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω—ã —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ—Å—Ç–æ–≤.

    {ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}"""

        prompt = f"""–°–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ù–ö–û.

    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - –ü–µ—Ä–∏–æ–¥: {duration_days} –¥–Ω–µ–π
    - –ß–∞—Å—Ç–æ—Ç–∞: {posts_per_week} –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
    {f"- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: {preferences}" if preferences else ""}

    –¢–∏–ø—ã –ø–æ—Å—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
    - –ê–Ω–æ–Ω—Å—ã —Å–æ–±—ã—Ç–∏–π
    - –ù–æ–≤–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    - –ü—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é
    - –û—Ç—á—ë—Ç—ã –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ
    - –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    - –ò—Å—Ç–æ—Ä–∏–∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
    - –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º –∏ –¥–æ–Ω–æ—Ä–∞–º

    –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
    –î–µ–Ω—å [—á–∏—Å–ª–æ.–º–µ—Å—è—Ü] - üìù –¢–∏–ø –ø–æ—Å—Ç–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ] - üí° –ò–¥–µ—è: [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]

    –°–æ–∑–¥–∞–π —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º —Ç–µ–º."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.7,
            max_tokens=3000
        )

    async def generate_structured_form_post(
            self,
            event: str,
            description: str,
            goal: str,
            date: Optional[str] = None,
            location: Optional[str] = None,
            platform: str = "universal",
            audience: str = "broad",
            style: str = "warm",
            length: str = "medium",
            additional_info: Optional[str] = None
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã (10 –≤–æ–ø—Ä–æ—Å–æ–≤)

        Args:
            event: –û –∫–∞–∫–æ–º —Å–æ–±—ã—Ç–∏–∏ –ø–æ—Å—Ç
            description: –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–¥—Ä–æ–±–Ω–µ–µ
            goal: –ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –ø–æ—Å—Ç–∞
            date: –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            location: –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            platform: –ü–ª–æ—â–∞–¥–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
            audience: –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
            style: –°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞
            length: –û–±—ä—ë–º —Ç–µ–∫—Å—Ç–∞
            additional_info: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

        Returns:
            –ì–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç
        """
        ngo_context = self._build_ngo_context()

        # –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∏–ª–µ–π
        style_map = {
            "warm": "—Ç—ë–ø–ª—ã–π –∏ —á–µ–ª–æ–≤–µ—á–Ω—ã–π",
            "facts": "—Å —Ñ–∞–∫—Ç–∞–º–∏ –∏ —Ü–∏—Ñ—Ä–∞–º–∏",
            "simple": "–ø—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π",
            "formal": "–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π",
            "emotional": "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π"
        }
        style_text = style_map.get(style, "—Ç—ë–ø–ª—ã–π –∏ —á–µ–ª–æ–≤–µ—á–Ω—ã–π")

        # –ú–∞–ø–ø–∏–Ω–≥ –æ–±—ä—ë–º–æ–≤
        length_map = {
            "short": "–∫–æ—Ä–æ—Ç–∫–∏–π (100-150 —Å–ª–æ–≤)",
            "medium": "—Å—Ä–µ–¥–Ω–∏–π (200-300 —Å–ª–æ–≤)",
            "long": "–ø–æ–¥—Ä–æ–±–Ω—ã–π (350-500 —Å–ª–æ–≤)"
        }
        length_text = length_map.get(length, "—Å—Ä–µ–¥–Ω–∏–π (200-300 —Å–ª–æ–≤)")

        # –ú–∞–ø–ø–∏–Ω–≥ –ø–ª–∞—Ç—Ñ–æ—Ä–º
        platform_map = {
            "telegram": "Telegram",
            "vk": "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ",
            "universal": "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ (–¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º)"
        }
        platform_text = platform_map.get(platform, "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ")

        # –ú–∞–ø–ø–∏–Ω–≥ –∞—É–¥–∏—Ç–æ—Ä–∏–π
        audience_map = {
            "locals": "–º–µ—Å—Ç–Ω—ã–µ –∂–∏—Ç–µ–ª–∏",
            "youth": "–º–æ–ª–æ–¥—ë–∂—å",
            "donors": "–¥–æ–Ω–æ—Ä—ã",
            "volunteers": "–≤–æ–ª–æ–Ω—Ç—ë—Ä—ã",
            "media": "–°–ú–ò",
            "broad": "—à–∏—Ä–æ–∫–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"
        }
        audience_text = audience_map.get(audience, "—à–∏—Ä–æ–∫–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è")

        # –ú–∞–ø–ø–∏–Ω–≥ —Ü–µ–ª–µ–π
        # goal –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ "struct_goal:result" –∏–ª–∏ "other:—Ç–µ–∫—Å—Ç"
        goal_map = {
            "result": "–ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã",
            "volunteers": "–ø—Ä–∏–≤–ª–µ—á—å –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤",
            "donations": "—Å–æ–±—Ä–∞—Ç—å –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è",
            "work": "—Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ä–∞–±–æ—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
            "thanks": "–≤—ã—Ä–∞–∑–∏—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å",
            "announcement": "–∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ"
        }
        
        # –ï—Å–ª–∏ —Ü–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "other:", –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –¥–≤–æ–µ—Ç–æ—á–∏—è
        if goal.startswith("other:"):
            goal_text = goal.split(":", 1)[1] if ":" in goal else goal
        elif ":" in goal:
            # –§–æ—Ä–º–∞—Ç "struct_goal:result" - –±–µ—Ä–µ–º —á–∞—Å—Ç—å –ø–æ—Å–ª–µ –¥–≤–æ–µ—Ç–æ—á–∏—è
            goal_value = goal.split(":")[1]
            goal_text = goal_map.get(goal_value, goal_value)
        else:
            # –ï—Å–ª–∏ –Ω–µ—Ç –¥–≤–æ–µ—Ç–æ—á–∏—è, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ø—Ä—è–º—É—é
            goal_text = goal_map.get(goal, goal)

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
–°–æ–∑–¥–∞–≤–∞–π –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

{ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}

üéØ –ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û:
–ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ñ–∞–∫—Ç—ã –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Å—É–º–º—ã (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã)
- –ò–º–µ–Ω–∞ –ª—é–¥–µ–π (–µ—Å–ª–∏ –Ω–µ –Ω–∞–∑–≤–∞–Ω—ã)
- –¢–æ—á–Ω—ã–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º—è (–µ—Å–ª–∏ –Ω–µ –¥–∞–Ω—ã)
- –î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏–π (–µ—Å–ª–∏ –Ω–µ –æ–ø–∏—Å–∞–Ω—ã)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è (–µ—Å–ª–∏ –Ω–µ —É–ø–æ–º—è–Ω—É—Ç—ã)

‚úÖ –ß–¢–û –ú–û–ñ–ù–û:
- –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–∫—Ä–∞—Å–∫—É –∫ –ò–ú–ï–Æ–©–ò–ú–°–Ø —Ñ–∞–∫—Ç–∞–º
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –î–æ–±–∞–≤–ª—è—Ç—å —É–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ë–ï–ó –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π

üìê –°–¢–†–£–ö–¢–£–†–ê:
‚Ä¢ –°–∏–ª—å–Ω–æ–µ –Ω–∞—á–∞–ª–æ (–≤–æ–ø—Ä–æ—Å/—Ñ–∞–∫—Ç/–∏–Ω—Ç—Ä–∏–≥–∞) - 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å (—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Ç–µ–º—ã) - 2-3 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞–±–∑–∞—Ü–∞ –ø–æ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
‚Ä¢ –î–µ—Ç–∞–ª–∏/–ø—Ä–æ—Ü–µ—Å—Å (–µ—Å–ª–∏ –µ—Å—Ç—å) - —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –∞–±–∑–∞—Ü
‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–≤—ã–≤–æ–¥/–ø—Ä–∏–∑—ã–≤/–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å) - 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
‚Ä¢ –•–µ—à—Ç–µ–≥–∏: 2-4 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö

‚öôÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –î–ª–∏–Ω–∞: {length_text}
- –°—Ç–∏–ª—å: {style_text}
- –ü–ª–æ—â–∞–¥–∫–∞: {platform_text}
- –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {audience_text}
- –≠–º–æ–¥–∑–∏: 1-3 —à—Ç—É–∫–∏ (–≤ –Ω–∞—á–∞–ª–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –∏–ª–∏ –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤)
- –ê–±–∑–∞—Ü—ã: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è max
- –°–ø–∏—Å–∫–∏: –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ (‚úÖ ‚úì ‚Ä¢ ‚Üí)
- –•–µ—à—Ç–µ–≥–∏: –≤ –∫–æ–Ω—Ü–µ, —Å # –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ë–µ–∑ –≤–æ–¥—ã, –∫–∞–Ω—Ü–µ–ª—è—Ä–∏–∑–º–æ–≤, —à—Ç–∞–º–ø–æ–≤
- –ñ–∏–≤–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —è–∑—ã–∫, –Ω–æ –≥—Ä–∞–º–æ—Ç–Ω—ã–π

‚ùå –ò–ó–ë–ï–ì–ê–ô:
- "–°–ø–µ—à–∏–º —Å–æ–æ–±—â–∏—Ç—å" (–∫–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç)
- –ò–∑–±—ã—Ç–æ—á–Ω—ã—Ö –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤!!!
- –ü–∞—Ñ–æ—Å–∞ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
- –û–±—â–∏—Ö —Ñ—Ä–∞–∑ —Ç–∏–ø–∞ "–º—ã –º–µ–Ω—è–µ–º –º–∏—Ä"
"""

        prompt_parts = [
            f"–°–û–ë–´–¢–ò–ï: {event}",
            f"–û–ü–ò–°–ê–ù–ò–ï: {description}",
            f"–ì–õ–ê–í–ù–ê–Ø –¶–ï–õ–¨ –ü–û–°–¢–ê: {goal_text}"
        ]

        if date:
            prompt_parts.append(f"–î–ê–¢–ê –ò –í–†–ï–ú–Ø: {date}")

        if location:
            prompt_parts.append(f"–ú–ï–°–¢–û –ü–†–û–í–ï–î–ï–ù–ò–Ø: {location}")

        if additional_info:
            prompt_parts.append(f"–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø: {additional_info}")

        prompt = f"""–°–æ–∑–¥–∞–π –ø–æ—Å—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

{chr(10).join(prompt_parts)}

–í–ê–ñ–ù–û:
- –†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ —Å —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –£—á–∏—Ç—ã–≤–∞–π —Ü–µ–ª—å –ø–æ—Å—Ç–∞: {goal_text}
- –ê–¥–∞–ø—Ç–∏—Ä—É–π —Å—Ç–∏–ª—å –ø–æ–¥ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é: {audience_text}
- –£—á–∏—Ç—ã–≤–∞–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: {platform_text}
- –°–æ–±–ª—é–¥–∞–π –æ–±—ä—ë–º: {length_text}
- –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∏–ª—å: {style_text}

–ù–ï –î–û–î–£–ú–´–í–ê–ô –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –≤–∑—è—Ç—å –≠–¢–ò —Ñ–∞–∫—Ç—ã –∏ –ø–æ–¥–∞—Ç—å –∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.7
        )

    async def generate_post_from_example(
            self,
            example_post: str,
            new_topic: str,
            style: Optional[str] = None
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞

        Args:
            example_post: –ü—Ä–∏–º–µ—Ä –≥–æ—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞
            new_topic: –ù–æ–≤–∞—è —Ç–µ–º–∞ –¥–ª—è –ø–æ—Å—Ç–∞
            style: –°—Ç–∏–ª—å (–µ—Å–ª–∏ None, –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø—Ä–∏–º–µ—Ä–∞)

        Returns:
            –ì–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç
        """
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

        {ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}

        –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∏–ª—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏–º–µ—Ä–∞."""

        prompt = f"""–í–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è:

        {example_post}

        –°–æ–∑–¥–∞–π –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–æ—Å—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ç–µ–º—É: {new_topic}

        {f"–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∏–ª—å: {style}" if style else "–°–æ—Ö—Ä–∞–Ω–∏ —Å—Ç–∏–ª—å –ø—Ä–∏–º–µ—Ä–∞"}

        –ù–æ–≤—ã–π –ø–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∞–∫—É—é –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫—É, –Ω–æ —Å –Ω–æ–≤—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.75
        )

    async def edit_post(
            self,
            original_post: str,
            edit_request: str
    ) -> str:
        """
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        Args:
            original_post: –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞
            edit_request: –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

        Returns:
            –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å—Ç
        """
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - —Ä–µ–¥–∞–∫—Ç–æ—Ä SMM-–ø–æ—Å—Ç–æ–≤ –¥–ª—è –ù–ö–û.

        {ngo_context if ngo_context else ""}

        üéØ –¢–í–û–Ø –ó–ê–î–ê–ß–ê:
        –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –†–ï–ê–õ–¨–ù–£–Æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

        üîÑ –ö–ê–ö –†–ê–ë–û–¢–ê–¢–¨:

        1Ô∏è‚É£ –ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø = –ò–°–¢–ò–ù–ê
        –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —ç—Ç–æ –†–ï–ê–õ–¨–ù–´–ï —Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ:
        ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–æ—Å—Ç
        ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–º–µ–Ω—ã –ø–æ—Ö–æ–∂–∏—Ö –Ω–µ—Ç–æ—á–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π

        2Ô∏è‚É£ –ù–ê–•–û–î–ò –ò –ó–ê–ú–ï–ù–Ø–ô –ü–†–û–¢–ò–í–û–†–ï–ß–ò–Ø
        –ï—Å–ª–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø–æ—Å—Ç–µ –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –∑–∞–ø—Ä–æ—Å—É:
        - –£–¥–∞–ª–∏ –∏–ª–∏ –∑–∞–º–µ–Ω–∏ –µ—ë –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
        - –ù–µ –æ—Å—Ç–∞–≤–ª—è–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –¥–µ—Ç–∞–ª–∏

        3Ô∏è‚É£ –°–û–•–†–ê–ù–Ø–ô –°–¢–ò–õ–¨ –ò –°–¢–†–£–ö–¢–£–†–£
        - –¢–æ–Ω –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
        - –û–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
        - –≠–º–æ–¥–∑–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—Å—è—Ç –∏–∑–º–µ–Ω–∏—Ç—å)

        üìã –ü–†–ò–ú–ï–†–´ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø:

        –ü—Ä–∏–º–µ—Ä 1:
        –ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Å—Ç: "–ó–∞ –¥–≤–∞ –¥–Ω—è —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–æ–∑–¥–∞–ª–∏ 5 –∫—Ä—É—Ç—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤..."
        –ó–∞–ø—Ä–æ—Å: "–•–∞–∫–∞—Ç–æ–Ω –¥–ª–∏–ª—Å—è 3 –¥–Ω—è –∏ –±—ã–ª–æ 7 –∫–æ–º–∞–Ω–¥"
        –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ó–∞ —Ç—Ä–∏ –¥–Ω—è —Å–µ–º—å –∫–æ–º–∞–Ω–¥ —Å–æ–∑–¥–∞–ª–∏ –∫—Ä—É—Ç—ã–µ –ø—Ä–æ–µ–∫—Ç—ã..."
        (—É–±—Ä–∞–ª–∏ "–¥–≤–∞ –¥–Ω—è" –∏ "5 –ø—Ä–æ–µ–∫—Ç–æ–≤", –¥–æ–±–∞–≤–∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ "3 –¥–Ω—è" –∏ "7 –∫–æ–º–∞–Ω–¥")

        –ü—Ä–∏–º–µ—Ä 2:
        –ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Å—Ç: "–°–æ–±—Ä–∞–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –∫–æ—Ä–º –¥–ª—è –ø—Ä–∏—é—Ç–∞"
        –ó–∞–ø—Ä–æ—Å: "–î–æ–±–∞–≤—å —á—Ç–æ —Å–æ–±—Ä–∞–ª–∏ 45 000 —Ä—É–±–ª–µ–π"
        –†–µ–∑—É–ª—å—Ç–∞—Ç: "–°–æ–±—Ä–∞–ª–∏ 45 000 —Ä—É–±–ª–µ–π –Ω–∞ –∫–æ—Ä–º –¥–ª—è –ø—Ä–∏—é—Ç–∞"
        (–¥–æ–±–∞–≤–∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—É–º–º—É)

        –ü—Ä–∏–º–µ—Ä 3:
        –ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Å—Ç: "–í–æ–ª–æ–Ω—Ç—ë—Ä—ã –ø–æ–º–æ–≥–ª–∏ –∂–∏–≤–æ—Ç–Ω—ã–º –≤ –ø—Ä–∏—é—Ç–µ"
        –ó–∞–ø—Ä–æ—Å: "–≠—Ç–æ –±—ã–ª–∏ –ú–∞—Ä–∏—è, –ê–ª–µ–∫—Å–µ–π –∏ –ò—Ä–∏–Ω–∞"
        –†–µ–∑—É–ª—å—Ç–∞—Ç: "–í–æ–ª–æ–Ω—Ç—ë—Ä—ã –ú–∞—Ä–∏—è, –ê–ª–µ–∫—Å–µ–π –∏ –ò—Ä–∏–Ω–∞ –ø–æ–º–æ–≥–ª–∏ –∂–∏–≤–æ—Ç–Ω—ã–º –≤ –ø—Ä–∏—é—Ç–µ"
        (–¥–æ–±–∞–≤–∏–ª–∏ –∏–º–µ–Ω–∞)

        –ü—Ä–∏–º–µ—Ä 4:
        –ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Å—Ç: "–°–∫–æ—Ä–æ –ø—Ä–æ–π–¥—ë—Ç –∞–∫—Ü–∏—è –ø–æ —Ä–∞–∑–¥–∞—á–µ –∫–æ—Ä–º–∞"
        –ó–∞–ø—Ä–æ—Å: "–ê–∫—Ü–∏—è 20 –¥–µ–∫–∞–±—Ä—è –≤ 14:00 –Ω–∞ –ø–ª–æ—â–∞–¥–∏ –õ–µ–Ω–∏–Ω–∞"
        –†–µ–∑—É–ª—å—Ç–∞—Ç: "20 –¥–µ–∫–∞–±—Ä—è –≤ 14:00 –Ω–∞ –ø–ª–æ—â–∞–¥–∏ –õ–µ–Ω–∏–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç –∞–∫—Ü–∏—è –ø–æ —Ä–∞–∑–¥–∞—á–µ –∫–æ—Ä–º–∞"
        (–¥–æ–±–∞–≤–∏–ª–∏ —Ç–æ—á–Ω—ã–µ –¥–∞—Ç—É, –≤—Ä–µ–º—è, –º–µ—Å—Ç–æ)

        –ü—Ä–∏–º–µ—Ä 5:
        –ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Å—Ç: "–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –¥–ª—è –¥–æ–±—Ä—ã—Ö –¥–µ–ª. –°–æ–∑–¥–∞–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–µ—Ä–≤–∏—Å—ã"
        –ó–∞–ø—Ä–æ—Å: "–û–Ω–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ —á–∞—Ç-–±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ —Å–∞–π—Ç —Å–±–æ—Ä–∞ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π"
        –†–µ–∑—É–ª—å—Ç–∞—Ç: "–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –¥–ª—è –¥–æ–±—Ä—ã—Ö –¥–µ–ª. –†–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ —á–∞—Ç-–±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ —Å–∞–π—Ç —Å–±–æ—Ä–∞ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π"
        (–∑–∞–º–µ–Ω–∏–ª–∏ –æ–±—â–∏–µ "–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–µ—Ä–≤–∏—Å—ã" –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã)

        ‚öôÔ∏è –ü–†–ê–í–ò–õ–ê:

        ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
        - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–°–Æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        - –û—Ä–≥–∞–Ω–∏—á–Ω–æ –≤–ø–ª–µ—Å—Ç–∏ –µ—ë –≤ —Ç–µ–∫—Å—Ç
        - –£–±—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
        - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

        ‚úÖ –°–¢–ò–õ–ò–°–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø (–µ—Å–ª–∏ –ø—Ä–æ—Å—è—Ç):
        "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ" ‚Üí —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç, –æ—Å—Ç–∞–≤–∏—Ç—å —Å—É—Ç—å
        "–î–æ–±–∞–≤—å —ç–º–æ—Ü–∏–π" ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏, –≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏—è, —è—Ä–∫–∏–µ —Å–ª–æ–≤–∞
        "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–µ–µ" ‚Üí —É–±—Ä–∞—Ç—å —ç–º–æ–¥–∑–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —è–∑—ã–∫
        "–£–±–µ—Ä–∏ —ç–º–æ–¥–∑–∏" ‚Üí —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —ç–º–æ–¥–∑–∏
        "–ü—Ä–æ—â–µ" ‚Üí –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞

        ‚ùå –ù–ï –î–ï–õ–ê–ô:
        - –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
        - –ù–µ –æ—Å—Ç–∞–≤–ª—è–π —Å—Ç–∞—Ä—ã–µ –¥–µ—Ç–∞–ª–∏, –µ—Å–ª–∏ –æ–Ω–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å –Ω–æ–≤—ã–º–∏
        - –ù–µ –¥–æ–±–∞–≤–ª—è–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –Ω–∏ –≤ –ø–æ—Å—Ç–µ, –Ω–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ"""

        prompt = f"""–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

        –ò–°–•–û–î–ù–´–ô –ü–û–°–¢:
        {original_post}
        
        –ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (—Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é):
        {edit_request}

        –ò–ù–°–¢–†–£–ö–¶–ò–Ø:
        1. –î–æ–±–∞–≤—å –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ø–æ—Å—Ç
        2. –ï—Å–ª–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø–æ—Å—Ç–µ –µ—Å—Ç—å –ø–æ—Ö–æ–∂–∞—è, –Ω–æ –¥—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –∑–∞–º–µ–Ω–∏ –µ—ë
        3. –°–æ—Ö—Ä–∞–Ω–∏ —Å—Ç–∏–ª—å, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–æ–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
        4. –°–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–º

        –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å—Ç –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.6
        )

    async def edit_text(
            self,
            text: str,
            edit_focus: str = "–≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã"
    ) -> Dict[str, Any]:
        """
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫

        Args:
            text: –¢–µ–∫—Å—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            edit_focus: –§–æ–∫—É—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è, –ª–æ–≥–∏–∫–∞, —Å—Ç–∏–ª—å)

        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏
        """
        system_prompt = """–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤.
        –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏, –¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é."""

        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –∏ –∏—Å–ø—Ä–∞–≤—å –µ–≥–æ.
        –§–æ–∫—É—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {edit_focus}

        –¢–µ–∫—Å—Ç:
        {text}

        –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ—Ç–≤–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

        –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–ï–ö–°–¢:
        [–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç]

        –ù–ê–ô–î–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:
        1. [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ]
        2. [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ]
        ...

        –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ:
        - [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1]
        - [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2]
        ..."""

        response = await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.3
        )

        # –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç
        sections = {
            "edited_text": "",
            "errors": [],
            "recommendations": []
        }

        current_section = None
        for line in response.split('\n'):
            line = line.strip()

            if "–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–ï–ö–°–¢:" in line:
                current_section = "edited_text"
                continue
            elif "–ù–ê–ô–î–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:" in line:
                current_section = "errors"
                continue
            elif "–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ:" in line:
                current_section = "recommendations"
                continue

            if current_section == "edited_text" and line:
                sections["edited_text"] += line + "\n"
            elif current_section == "errors" and line:
                sections["errors"].append(line)
            elif current_section == "recommendations" and line:
                sections["recommendations"].append(line)

        sections["edited_text"] = sections["edited_text"].strip()
        sections["full_response"] = response

        return sections

    async def generate_content_plan(
            self,
            duration_days: int,
            posts_per_week: int,
            preferences: Optional[str] = None
    ) -> str:
        """
        –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞

        Args:
            duration_days: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞ –≤ –¥–Ω—è—Ö
            posts_per_week: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
            preferences: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ —Ç–µ–º–∞–º/—Ñ–æ—Ä–º–∞—Ç–∞–º

        Returns:
            –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω
        """
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –æ–ø—ã—Ç–Ω—ã–π SMM-—Å—Ç—Ä–∞—Ç–µ–≥ –¥–ª—è –ù–ö–û.
                –°–æ–∑–¥–∞—ë—à—å –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω—ã, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –°–¢–†–û–ì–û –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

                {ngo_context if ngo_context else "–î–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ù–ö–û"}

                –í–ê–ñ–ù–û:
                - –í—Å–µ —Ç–µ–º—ã –ø–æ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                - –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
                - –û–ø–∏—Ä–∞–π—Å—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ–≥–∏–æ–Ω —Ä–∞–±–æ—Ç—ã
                - –ü—Ä–µ–¥–ª–∞–≥–∞–π —Ç–∏–ø–æ–≤—ã–µ —Ç–µ–º—ã, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è"""

        # –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
        full_weeks = duration_days // 7
        extra_days = duration_days % 7

        # –ü–æ—Å—Ç—ã –∑–∞ –ø–æ–ª–Ω—ã–µ –Ω–µ–¥–µ–ª–∏
        posts_full_weeks = full_weeks * posts_per_week

        # –ü–æ—Å—Ç—ã –∑–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏ (–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        posts_extra_days = round(extra_days * posts_per_week / 7) if extra_days > 0 else 0

        # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
        total_posts = posts_full_weeks + posts_extra_days

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã –¥–ª—è –ø–æ—Å—Ç–æ–≤
        start_date = datetime.now()
        post_dates = []

        # –í—Ä–µ–º–µ–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
        posting_times = ["10:00", "14:00", "18:00", "12:00", "16:00", "20:00", "11:00"]

        if total_posts > 0:
            # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å—Ç—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ –¥–Ω—è–º
            interval = duration_days / total_posts

            for i in range(total_posts):
                post_day = start_date + timedelta(days=int(i * interval))
                day_name = post_day.strftime("%a").upper()
                day_names = {"MON": "–ü–ù", "TUE": "–í–¢", "WED": "–°–†", "THU": "–ß–¢",
                             "FRI": "–ü–¢", "SAT": "–°–ë", "SUN": "–í–°"}

                post_dates.append({
                    "day_name": day_names.get(day_name, day_name),
                    "date": post_day.strftime("%d.%m"),
                    "time": posting_times[i % len(posting_times)],
                    "week": (post_day - start_date).days // 7 + 1
                })

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –≥–æ—Ç–æ–≤—ã–º–∏ –¥–∞—Ç–∞–º–∏
        posts_structure = ""
        current_week = 0

        for idx, post_date in enumerate(post_dates, 1):
            if post_date["week"] != current_week:
                current_week = post_date["week"]
                week_posts_count = sum(1 for p in post_dates if p["week"] == current_week)
                posts_structure += f"\n<b>üìÖ –ù–µ–¥–µ–ª—è {current_week}</b> ({week_posts_count} {'–ø–æ—Å—Ç' if week_posts_count == 1 else '–ø–æ—Å—Ç–æ–≤'})\n\n"

            posts_structure += f"<b>{post_date['day_name']} {post_date['date']}, {post_date['time']}</b>\n"
            posts_structure += f"[–ó–ê–ü–û–õ–ù–ò: –¢–∏–ø –ø–æ—Å—Ç–∞ (üìù/‚ù§Ô∏è/üìä/ü§ù/üôè/üìÖ)]\n"
            posts_structure += f"–¢–µ–º–∞: [–ó–ê–ü–û–õ–ù–ò —Ç–µ–º—É, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏]\n"
            posts_structure += f"–§–æ—Ä–º–∞—Ç: –¢–µ–∫—Å—Ç + —Ñ–æ—Ç–æ\n\n"

            if idx < len(post_dates):
                posts_structure += "---\n\n"

        prompt = f"""–°–æ—Å—Ç–∞–≤—å –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ù–ö–û.

        üìä –ü–ê–†–ê–ú–ï–¢–†–´:
        - –ü–µ—Ä–∏–æ–¥: {duration_days} –¥–Ω–µ–π
        - –ß–∞—Å—Ç–æ—Ç–∞: {posts_per_week} –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
        - –ò–¢–û–ì–û –ü–û–°–¢–û–í: {total_posts}
        {f"- –ü–æ–∂–µ–ª–∞–Ω–∏—è: {preferences}" if preferences else ""}

        ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
        –ö–û–õ–ò–ß–ï–°–¢–í–û –ü–û–°–¢–û–í –°–¢–†–û–ì–û –§–ò–ö–°–ò–†–û–í–ê–ù–û: {total_posts} {'–ø–æ—Å—Ç' if total_posts == 1 else '–ø–æ—Å—Ç–æ–≤'}
        –ù–ï –î–û–ë–ê–í–õ–Ø–ô –±–æ–ª—å—à–µ –ø–æ—Å—Ç–æ–≤! –ù–ï –£–î–ê–õ–Ø–ô –ø–æ—Å—Ç—ã!
        –î–∞—Ç—ã –∏ –≤—Ä–µ–º—è –£–ñ–ï –†–ê–°–°–ß–ò–¢–ê–ù–´ - —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–∏ —Ç–µ–º—ã!

        –¢–ò–ü–´ –ö–û–ù–¢–ï–ù–¢–ê (–≤—ã–±–∏—Ä–∞–π –ø–æ–¥—Ö–æ–¥—è—â–∏–µ):
        üì¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç—ã, —Ñ–∞–∫—Ç—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        ‚ù§Ô∏è –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ - –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–º–æ—â–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã
        üìä –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å - –æ—Ç—á—ë—Ç—ã, —Ü–∏—Ñ—Ä—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        ü§ù –í–æ–≤–ª–µ—á–µ–Ω–∏–µ - –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Å—É–∂–¥–µ–Ω–∏—è, –ø—Ä–∏–∑—ã–≤—ã
        üôè –ü—Ä–∏–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º –∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º
        üìÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ–µ - –∞–Ω–æ–Ω—Å—ã, –Ω–æ–≤–æ—Å—Ç–∏, –Ω–∞–±–æ—Ä—ã

        üìã –°–¢–†–£–ö–¢–£–†–ê –ü–õ–ê–ù–ê (–ó–ê–ü–û–õ–ù–ò –¢–ï–ú–´):

        {posts_structure}

        –ó–ê–î–ê–ß–ê:
        1. –ó–∞–º–µ–Ω–∏ "[–ó–ê–ü–û–õ–ù–ò: –¢–∏–ø –ø–æ—Å—Ç–∞]" –Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø —Å —ç–º–æ–¥–∑–∏
        2. –ó–∞–º–µ–Ω–∏ "[–ó–ê–ü–û–õ–ù–ò —Ç–µ–º—É...]" –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ–º—É, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
        3. –ù–ï –ú–ï–ù–Ø–ô –¥–∞—Ç—ã, –≤—Ä–µ–º—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
        4. –ù–ï –î–û–ë–ê–í–õ–Ø–ô –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã
        5. –í—Å–µ —Ç–µ–º—ã –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—é –ù–ö–û

        –í–µ—Ä–Ω–∏ –≥–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.6,
            max_tokens=3000
        )