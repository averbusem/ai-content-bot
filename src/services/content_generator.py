from typing import Optional, Dict, Any
from .models.gigachat import GigaChatModel


class ContentGenerator:
    def __init__(self, gigachat_model: GigaChatModel):
        self.model = gigachat_model
        self.ngo_info: Optional[Dict[str, Any]] = None

    def set_ngo_info(self, ngo_info: Dict[str, Any]):
        self.ngo_info = ngo_info

    def _build_ngo_context(self) -> str:
        """–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–± –ù–ö–û –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞"""
        if not self.ngo_info:
            return ""

        context_parts = []

        if self.ngo_info.get("name"):
            context_parts.append(f"–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: {self.ngo_info['name']}")

        if self.ngo_info.get("description"):
            context_parts.append(f"–û–ø–∏—Å–∞–Ω–∏–µ: {self.ngo_info['description']}")

        if self.ngo_info.get("activities"):
            context_parts.append(f"–§–æ—Ä–º—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: {self.ngo_info['activities']}")

        if self.ngo_info.get("target_audience"):
            context_parts.append(f"–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {self.ngo_info['target_audience']}")

        if self.ngo_info.get("values"):
            context_parts.append(f"–¶–µ–Ω–Ω–æ—Å—Ç–∏: {self.ngo_info['values']}")

        if context_parts:
            return "\n".join(context_parts)
        return ""

    async def generate_free_text_post(
            self,
            user_idea: str,
            style: str = "—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π",
            additional_info: Optional[str] = None
    ) -> str:
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π.

{ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ—Å—Ç—É:
- –°—Ç–∏–ª—å: {style}
- –ë–µ–∑ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö, –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö, –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏ —Ä–µ—á–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –õ–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç—å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å 2-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–∞ –≤ –∫–æ–Ω—Ü–µ
- –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫
- –î–ª–∏–Ω–∞: 200-400 —Å–ª–æ–≤"""

        prompt = f"""–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –∏–¥–µ–∏ —Å–æ–∑–¥–∞–π –≥–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏:

–ò–¥–µ—è: {user_idea}

{f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: {additional_info}" if additional_info else ""}

–°–æ–∑–¥–∞–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–æ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.8
        )

    async def generate_structured_post(
            self,
            event_type: str,
            date: str,
            location: str,
            participants: str,
            details: str,
            style: str = "—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π"
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ —à–∞–±–ª–æ–Ω—É

        Args:
            event_type: –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
            date: –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è
            location: –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
            participants: –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω
            details: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
            style: –°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞

        Returns:
            –ì–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç
        """
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
–°–æ–∑–¥–∞–≤–∞–π –ø–æ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

{ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}
        –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
        - –°—Ç–∏–ª—å: {style}
        - –õ–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        - –ü—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞
        - 2-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–∞"""

        prompt = f"""–°–æ–∑–¥–∞–π –∞–Ω–æ–Ω—Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

        –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: {event_type}
        –î–∞—Ç–∞: {date}
        –ú–µ—Å—Ç–æ: {location}
        –£—á–∞—Å—Ç–Ω–∏–∫–∏: {participants}
        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏: {details}

        –°–æ–∑–¥–∞–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç-–∞–Ω–æ–Ω—Å."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.7
        )

    async def generate_post_from_example(
            self,
            example_post: str,
            new_topic: str,
            style: Optional[str] = None
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞

        Args:
            example_post: –ü—Ä–∏–º–µ—Ä –≥–æ—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞
            new_topic: –ù–æ–≤–∞—è —Ç–µ–º–∞ –¥–ª—è –ø–æ—Å—Ç–∞
            style: –°—Ç–∏–ª—å (–µ—Å–ª–∏ None, –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø—Ä–∏–º–µ—Ä–∞)

        Returns:
            –ì–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç
        """
        ngo_context = self._build_ngo_context()

        system_prompt = f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

        {ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}

        –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∏–ª—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏–º–µ—Ä–∞."""

        prompt = f"""–í–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è:

        {example_post}

        –°–æ–∑–¥–∞–π –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–æ—Å—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ç–µ–º—É: {new_topic}

        {f"–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∏–ª—å: {style}" if style else "–°–æ—Ö—Ä–∞–Ω–∏ —Å—Ç–∏–ª—å –ø—Ä–∏–º–µ—Ä–∞"}

        –ù–æ–≤—ã–π –ø–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∞–∫—É—é –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫—É, –Ω–æ —Å –Ω–æ–≤—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º."""

        return await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.75
        )

    async def edit_text(
            self,
            text: str,
            edit_focus: str = "–≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã"
    ) -> Dict[str, Any]:
        """
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫

        Args:
            text: –¢–µ–∫—Å—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            edit_focus: –§–æ–∫—É—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è, –ª–æ–≥–∏–∫–∞, —Å—Ç–∏–ª—å)

        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏
        """
        system_prompt = """–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤.
        –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏, –¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é."""

        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –∏ –∏—Å–ø—Ä–∞–≤—å –µ–≥–æ.
        –§–æ–∫—É—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {edit_focus}

        –¢–µ–∫—Å—Ç:
        {text}

        –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ—Ç–≤–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

        –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–ï–ö–°–¢:
        [–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç]

        –ù–ê–ô–î–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:
        1. [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ]
        2. [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ]
        ...

        –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ:
        - [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1]
        - [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2]
        ..."""

        response = await self.model.generate_text(
            prompt=prompt,
            system_prompt=system_prompt,
            temperature=0.3
        )

        # –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç
        sections = {
            "edited_text": "",
            "errors": [],
            "recommendations": []
        }

        current_section = None
        for line in response.split('\n'):
            line = line.strip()

            if "–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–ï–ö–°–¢:" in line:
                current_section = "edited_text"
                continue
            elif "–ù–ê–ô–î–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:" in line:
                current_section = "errors"
                continue
            elif "–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ:" in line:
                current_section = "recommendations"
                continue

            if current_section == "edited_text" and line:
                sections["edited_text"] += line + "\n"
            elif current_section == "errors" and line:
                sections["errors"].append(line)
            elif current_section == "recommendations" and line:
                sections["recommendations"].append(line)

                sections["edited_text"] = sections["edited_text"].strip()
                sections["full_response"] = response

                return sections

            async def generate_content_plan(
                    self,
                    duration_days: int,
                    posts_per_week: int,
                    preferences: Optional[str] = None
            ) -> str:
                """
                –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞

                Args:
                    duration_days: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞ –≤ –¥–Ω—è—Ö
                    posts_per_week: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
                    preferences: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ —Ç–µ–º–∞–º/—Ñ–æ—Ä–º–∞—Ç–∞–º

                Returns:
                    –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω
                """
                ngo_context = self._build_ngo_context()

                system_prompt = f"""–¢—ã - SMM-—Å—Ç—Ä–∞—Ç–µ–≥ –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
                –°–æ–∑–¥–∞–≤–∞–π –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω—ã —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ—Å—Ç–æ–≤.

                {ngo_context if ngo_context else "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞"}"""

                prompt = f"""–°–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ –ù–ö–û.

                –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
                - –ü–µ—Ä–∏–æ–¥: {duration_days} –¥–Ω–µ–π
                - –ß–∞—Å—Ç–æ—Ç–∞: {posts_per_week} –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
                {f"- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: {preferences}" if preferences else ""}

                –¢–∏–ø—ã –ø–æ—Å—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
                - –ê–Ω–æ–Ω—Å—ã —Å–æ–±—ã—Ç–∏–π
                - –ù–æ–≤–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                - –ü—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é
                - –û—Ç—á—ë—Ç—ã –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ
                - –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                - –ò—Å—Ç–æ—Ä–∏–∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
                - –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º –∏ –¥–æ–Ω–æ—Ä–∞–º

                –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
                –î–µ–Ω—å [—á–∏—Å–ª–æ] ([–¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏]):
                üìù –¢–∏–ø –ø–æ—Å—Ç–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
                üí° –ò–¥–µ—è: [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]

                –°–æ–∑–¥–∞–π —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º —Ç–µ–º."""

                return await self.model.generate_text(
                    prompt=prompt,
                    system_prompt=system_prompt,
                    temperature=0.7,
                    max_tokens=3000
                )

            async def generate_image_prompt(
                    self,
                    post_text: str,
                    image_description: Optional[str] = None
            ) -> str:
                """
                –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞

                Args:
                    post_text: –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞
                    image_description: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∂–µ–ª–∞–µ–º–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

                Returns:
                    –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                """
                system_prompt = """–¢—ã - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
                –°–æ–∑–¥–∞–≤–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è AI, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è –ø–æ—Å—Ç–∞ –ù–ö–û."""

                prompt = f"""–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞ —Å–æ–∑–¥–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

                –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞:
                {post_text}

                {f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è: {image_description}" if image_description else ""}

                –ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω:
                - –ë—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
                - –°–æ–¥–µ—Ä–∂–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∏–ª—è (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è, –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏ —Ç.–¥.)
                - –û–ø–∏—Å—ã–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
                - –ë—ã—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–º–µ –ù–ö–û –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏
                - –ù–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏

                –°–æ–∑–¥–∞–π –ø—Ä–æ–º–ø—Ç –¥–ª–∏–Ω–æ–π 50-150 —Å–ª–æ–≤."""

                return await self.model.generate_text(
                    prompt=prompt,
                    system_prompt=system_prompt,
                    temperature=0.7
                )